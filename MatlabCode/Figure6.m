clear;
clc;
% 此为原Paper中Figure6复现代码

% 状态初值如下
X0  = [-10.2999, 0.2575, -4.4997, 3.6258, 3.0922, 9.0156, 3.5099, -2.6645, 2.4552, -4.4921]';

Node_Nums = 10;

% b图度矩阵，邻接矩阵，拉普拉斯矩阵
D_a = [ 1 0 0 0 0 0 0 0 0 0;
        0 1 0 0 0 0 0 0 0 0;
        0 0 1 0 0 0 0 0 0 0;
        0 0 0 1 0 0 0 0 0 0;
        0 0 0 0 1 0 0 0 0 0;
        0 0 0 0 0 1 0 0 0 0;
        0 0 0 0 0 0 1 0 0 0;
        0 0 0 0 0 0 0 1 0 0;
        0 0 0 0 0 0 0 0 1 0;
        0 0 0 0 0 0 0 0 0 1;];
A_a = [ 0 1 0 0 0 0 0 0 0 0;
        0 0 1 0 0 0 0 0 0 0;
        0 0 0 1 0 0 0 0 0 0;
        0 0 0 0 1 0 0 0 0 0;
        0 0 0 0 0 1 0 0 0 0;
        0 0 0 0 0 0 1 0 0 0;
        0 0 0 0 0 0 0 1 0 0;
        0 0 0 0 0 0 0 0 1 0;
        0 0 0 0 0 0 0 0 0 1;
        1 0 0 0 0 0 0 0 0 0;];
L_a = D_a - A_a;

% b图度矩阵，邻接矩阵，拉普拉斯矩阵
D_b = [ 1 0 0 0 0 0 0 0 0 0;
        0 2 0 0 0 0 0 0 0 0;
        0 0 2 0 0 0 0 0 0 0;
        0 0 0 2 0 0 0 0 0 0;
        0 0 0 0 1 0 0 0 0 0;
        0 0 0 0 0 2 0 0 0 0;
        0 0 0 0 0 0 1 0 0 0;
        0 0 0 0 0 0 0 1 0 0;
        0 0 0 0 0 0 0 0 1 0;
        0 0 0 0 0 0 0 0 0 2;];
A_b = [ 0 1 0 0 0 0 0 0 0 0;
        0 0 1 0 0 0 0 0 0 1;
        0 0 0 1 0 0 0 1 0 0;
        0 0 0 0 1 1 0 0 0 0;
        0 0 0 0 0 1 0 0 0 0;
        0 0 0 1 0 0 1 0 0 0;
        0 0 0 0 0 0 0 1 0 0;
        0 0 0 0 0 0 0 0 1 0;
        0 0 0 0 0 0 0 0 0 1;
        1 1 0 0 0 0 0 0 0 0;];
L_b = D_b - A_b;

% c图度矩阵，邻接矩阵，拉普拉斯矩阵
D_c = [ 2 0 0 0 0 0 0 0 0 0;
        0 1 0 0 0 0 0 0 0 0;
        0 0 1 0 0 0 0 0 0 0;
        0 0 0 2 0 0 0 0 0 0;
        0 0 0 0 1 0 0 0 0 0;
        0 0 0 0 0 1 0 0 0 0;
        0 0 0 0 0 0 1 0 0 0;
        0 0 0 0 0 0 0 2 0 0;
        0 0 0 0 0 0 0 0 2 0;
        0 0 0 0 0 0 0 0 0 1;];
A_c = [ 0 1 0 0 0 0 0 0 1 0;
        0 0 1 0 0 0 0 0 0 0;
        0 0 0 1 0 0 0 0 0 0;
        0 0 0 0 1 0 0 1 0 0;
        0 0 0 0 0 1 0 0 0 0;
        0 0 0 0 0 0 1 0 0 0;
        0 0 0 0 0 0 0 1 0 0;
        0 0 0 1 0 0 0 0 1 0;
        1 0 0 0 0 0 0 0 0 1;
        1 0 0 0 0 0 0 0 0 0;];
L_c = D_c - A_c;

% d图度矩阵，邻接矩阵，拉普拉斯矩阵
D_d = [ 2 0 0 0 0 0 0 0 0 0;
        0 2 0 0 0 0 0 0 0 0;
        0 0 1 0 0 0 0 0 0 0;
        0 0 0 2 0 0 0 0 0 0;
        0 0 0 0 2 0 0 0 0 0;
        0 0 0 0 0 1 0 0 0 0;
        0 0 0 0 0 0 2 0 0 0;
        0 0 0 0 0 0 0 3 0 0;
        0 0 0 0 0 0 0 0 2 0;
        0 0 0 0 0 0 0 0 0 1;];
% 邻接矩阵，有向拓扑结构
A_d = [ 0 1 0 0 0 0 0 0 1 0;
        0 0 1 0 0 0 0 1 0 0;
        0 0 0 1 0 0 0 0 0 0;
        0 0 0 0 1 0 0 1 0 0;
        0 0 0 0 0 1 1 0 0 0;
        0 0 0 0 0 0 1 0 0 0;
        0 0 0 0 1 0 0 1 0 0;
        0 1 0 1 0 0 0 0 1 0;
        1 0 0 0 0 0 0 0 0 1;
        1 0 0 0 0 0 0 0 0 0;];
L_d = D_d - A_d;

% 设置收敛相关参数
tBegin = 0;                     % 开始时间 
tEnd   = 15;                    % 结束时间
dt     = 0.1;                   % 最小时间间隔
times  = (tEnd-tBegin) / dt;    % 迭代计算次数
time   = 1;
% 定义记录时间数组
t(:,1)   = tBegin;
% 定义图数据存储数组
% t=0时刻，状态为b
X(:,1) = X0;
U(:,1) = -L_b * X0;
Delta(:,1) = X0' * L_b * X0;

% 开始收敛计算
while(time <= times)
    % 迭代顺序为 b->a->d->c->b
    if ((time>=1 && time<=10)||(time>=41 && time<=50)||(time>=81 && time<=90)||(time>=121 && time<=130))
        L = L_b;
    elseif((time>=11 && time<=20)||(time>=51 && time<=60)||(time>=91 && time<=100)||(time>=131 && time<=140))
        L = L_a;
    elseif((time>=21 && time<=30)||(time>=61 && time<=70)||(time>=101 && time<=110)||(time>=141 && time<=150))
        L = L_d;
    elseif((time>=31 && time<=40)||(time>=71 && time<=80)||(time>=111 && time<=120))
        L = L_c;
    end
    
    t(:,time+1) = tBegin + time * dt;
    
    X(:,time+1) = expm(-L * t(:,time+1)) * X0;
    U(:,time+1) = -L * X(:,time+1);
    Delta(:,time+1) = X(:,time+1)'*L*X(:,time+1);
    
    time = time + 1;
end

% 绘制图数据
subplot(2,1,1);
plot(t,X(1,:), t,X(2,:), t,X(3,:), t,X(4,:), t,X(5,:), t,X(6,:), t,X(7,:), t,X(8,:), t,X(9,:), t,X(10,:), 'linewidth',1.5)
xlabel("time(sec)");ylabel("node value");
subplot(2,1,2);
plot(t,Delta, 'linewidth',1.5);
xlabel("time(sec)");ylabel("disagreement");